<script>
  var height = $(window).height();
  $(".height_graph").css("height",height * 75/100 - 60 );

  $(document).keyup(function(e){
     if(e.which==122){
       location.reload();
     }
  });
</script>


<div class="col-md-7 height_graph">
  <div class="col-md-4" >
    <h2><b>PRODUCTION</b></h2>
    <strong><h2><b><%= Line.find_by(:no=>big.first).nama %></b></h2></strong>
  </div>
  <div class="col-md-8">
    <span id="legendDiv_<%= big.first.to_s %>"></span>
  </div>
  <div class="col-md-12" style="height:80%">
    <canvas id="canvas_<%= big.first.to_s %>" style="width:100%;height:100%;" ></canvas>
  </div>
</div>

<div class="col-md-5 height_graph" >
  <div class="col-md-12" style="height:50%;width:100%;">
    <div class="col-md-4">
      <h2><b>DEFECT INT</b></h2>
      <strong><h2><b><%= Line.find_by(:no=>big.first).nama %></b><h2></strong>
    </div>
    <div class="col-md-8">
      <span id="legendDiv_def_int_<%= big.first.to_s %>"></span>
    </div>
    <div class="col-md-12" style="height:60%;width:100%;">
      <canvas id="canvas_def_int_<%= big.first.to_s %>"  ></canvas>
    </div>
  </div>
  <div class="col-md-12" style="height:50%;width:100%;">
    <div class="col-md-4" >
      <h2><b>DEFECT EXT</b></h2>
      <strong><h2><b><%= Line.find_by(:no=>big.first).nama %></b><h2></strong>
    </div>
    <div class="col-md-8">
      <span id="legendDiv_def_ext_<%= big.first.to_s %>"></span>
    </div>
    <div class="col-md-12" style="height:60%;width:100%;">
      <canvas id="canvas_def_ext_<%= big.first.to_s %>"  ></canvas>
    </div>
  </div>
</div>

<div class="col-md-12 board_bottom" >
  <div class="col-md-4"><b><font color='darkblue'>P/O: </font><font color='black'><%= begin Line.find_by(:no=>big.first).reports.find_by("tanggal = ?",Date.today).detailreports.last.po rescue "" end %></font></b></div>
  <div class="col-md-4"><b><font  color='darkblue'>MFG No: </font><font  color='black'><%= begin Line.find_by(:no=>big.first).reports.find_by("tanggal = ?",Date.today).detailreports.last.mfg rescue "" end %></font></b></div>
  <div class="col-md-4"><b><font  color='darkblue'>Article: </font><font color='black'><%= begin Line.find_by(:no=>big.first).reports.find_by("tanggal = ?",Date.today).detailreports.last.article rescue "" end %></font></b></div>
</div>


<script>


      <%= "graph_" + big.first.to_s %> = {
          //labels : ["07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00", "15:00", "16:00", "17:00", "18:00","19:00","20:00"],
          labels : <%=raw @working_hour.pluck(:start).push(@working_hour.last.end).push( (@working_hour.last.end.to_time+1.hour ).strftime("%H:%M")) %>,
          datasets : [
            {
              label: "Target",
              fillColor : "rgba(19,104,133,0.5)",
              strokeColor : "darkblue",
              pointColor : "darkblue",
              pointStrokeColor : "darkblue",
              pointHighlightFill : "darkblue",
              pointHighlightStroke : "rgba(220,220,220,1)",
              data : <%= big[1][0] %>
            },
            {
              label: "Actual",
              fillColor : "rgba(212,78,209,0.5)",
              strokeColor : "magenta",
              pointColor : "magenta",
              pointStrokeColor : "magenta",
              pointHighlightFill : "magenta",
              pointHighlightStroke : "rgba(151,187,205,1)",
              data : <%= big[1][1] %>
            }
          ]

        }

        ctx = document.getElementById("canvas_<%= big.first.to_s %>").getContext("2d");
        window.myLine = new Chart(ctx).Line(<%= "graph_" + big.first.to_s %>, {
          responsive: true,
          animation : false,
          scaleShowHorizontalLines: true,
          scaleFontSize: 20,
          scaleFontStyle: "bold",
          legendTemplate : '<ul class="graph-legend">'
                        +'<li class="target">'
                        +' Target'
                        +'</li>'
                        +'<li class="actual">'
                        +' Actual'
                        +'</li>'

                  +'</ul>'
        });
        document.getElementById("legendDiv_<%= big.first.to_s %>").innerHTML = myLine.generateLegend();

        //defect INT

    <%= "graph_def_int" + big.first.to_s %> = {
          labels : <%=raw big[1][3] %> ,
          datasets : [
            {
              label: "Defect Internal",
              fillColor : "rgba(231,30,19,0.5)",
              strokeColor : "rgb(231,30,19)",
              pointColor : "rgb(231,30,19)",
              pointStrokeColor : "rgb(231,30,19)",
              pointHighlightFill : "rgb(231,30,19)",
              pointHighlightStroke : "rgba(220,220,220,1)",
              data : <%= big[1][2] %>
            }
          ]

        }


        ctx = document.getElementById("canvas_def_int_<%= big.first.to_s %>").getContext("2d");
        window.mybar1 = new Chart(ctx).Bar(<%= "graph_def_int" + big.first.to_s %>, {
          responsive: true,
              maintainAspectRatio: false,
          showTooltips: true,
          animation : false,
          scaleShowHorizontalLines: true,
          scaleFontSize: 20,
          scaleFontStyle: "bold",
          legendTemplate : '<ul class="graph-legend">'
                        +'<li class="satu">'
                        +' 1. <%=raw big[1][4][0] %> &nbsp;'
                        +'</li>'
                        +'<li class="dua">'
                        +' 2. <%=raw big[1][4][1] %> &nbsp;'
                        +'</li>'
                        +'<li class="tiga">'
                        +' 3. <%=raw big[1][4][2] %> &nbsp;'
                        +'</li>'

                  +'</ul>'
          // onAnimationComplete: function()
          // {
          //     this.showTooltip(this.datasets[0].bars, true);
          // }
        });

        mybar1.datasets[0].bars[0].fillColor = "red";
        mybar1.datasets[0].bars[1].fillColor = "orange";
        mybar1.datasets[0].bars[2].fillColor = "yellow";
        mybar1.update();

        document.getElementById("legendDiv_def_int_<%= big.first.to_s %>").innerHTML = mybar1.generateLegend();


        // defect EXT


        <%= "graph_def_ext" + big.first.to_s %> = {
          labels : <%=raw big[1][6] %>,
          datasets : [
            {
              label: "Defect Internal",
              fillColor : "rgba(231,200,19,0.5)",
              strokeColor : "rgb(231,30,19)",
              pointColor : "rgb(231,30,19)",
              pointStrokeColor : "rgb(231,30,19)",
              pointHighlightFill : "rgb(231,30,19)",
              pointHighlightStroke : "rgba(220,220,220,1)",
              data : <%= big[1][5] %>
            }
          ]

        }

        ctx = document.getElementById("canvas_def_ext_<%= big.first.to_s %>").getContext("2d");
        window.mybar2 = new Chart(ctx).Bar(<%= "graph_def_ext" + big.first.to_s %>, {
          responsive: true,
              maintainAspectRatio: false,
          showTooltips: true,
          animation : false,
          scaleShowHorizontalLines: true,
          scaleFontSize: 20,
          scaleFontStyle: "bold",
          legendTemplate : '<ul class="graph-legend">'
                        +'<li class="satu">'
                        +' 1. <%=raw big[1][7][0] %> &nbsp;'
                        +'</li>'
                        +'<li class="dua">'
                        +' 2. <%=raw big[1][7][1] %> &nbsp;'
                        +'</li>'
                        +'<li class="tiga">'
                        +' 3. <%=raw big[1][7][2] %> &nbsp;'
                        +'</li>'

                  +'</ul>'
          // onAnimationComplete: function()
          // {
          //     this.showTooltip(this.datasets[0].bars, true);
          // }
        });

        mybar2.datasets[0].bars[0].fillColor = "red";
        mybar2.datasets[0].bars[1].fillColor = "orange";
        mybar2.datasets[0].bars[2].fillColor = "yellow";
        mybar2.update();

         document.getElementById("legendDiv_def_ext_<%= big.first.to_s %>").innerHTML = mybar2.generateLegend();


        // defect

    // <%#= "graph_def_" + big.first.to_s %> = {
    //       labels : ["07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00", "15:00", "16:00", "17:00", "18:00","19:00","20:00"],
    //       datasets : [
    //         {
    //           label: "Defect Internal",
    //           fillColor : "rgba(231,30,19,0.5)",
    //           strokeColor : "rgb(231,30,19)",
    //           pointColor : "rgb(231,30,19)",
    //           pointStrokeColor : "rgb(231,30,19)",
    //           pointHighlightFill : "rgb(231,30,19)",
    //           pointHighlightStroke : "rgba(220,220,220,1)",
    //           data : <%= big[1][2] %>
    //         },
    //         {
    //           label: "Defect External",
    //           fillColor : "rgba(87,87,87,0.5)",
    //           strokeColor : "black",
    //           pointColor : "black",
    //           pointStrokeColor : "black",
    //           pointHighlightFill : "black",
    //           pointHighlightStroke : "rgba(151,187,205,1)",
    //           data : <%= big[1][3] %>
    //         }
    //       ]

    //     }

    //     ctx = document.getElementById("canvas_def_<%= big.first.to_s %>").getContext("2d");
    //     window.myLine = new Chart(ctx).Line(<%= "graph_def_" + big.first.to_s %>, {
    //       responsive: true,
    //       animation : false,
    //       scaleShowHorizontalLines: true,
    //       scaleFontSize: 20,
    //       scaleFontStyle: "bold",
    //       legendTemplate : '<ul class="graph-legend">'
    //                     +'<li class="def-int">'
    //                     +' <font size=6>Defect Int</font>'
    //                     +'</li>'
    //                     +'<li class="def-ext">'
    //                     +' <font size=6>Defect Ext</font>'
    //                     +'</li>'

    //               +'</ul>'
    //     });
    //     document.getElementById("legendDiv_def_<%= big.first.to_s %>").innerHTML = myLine.generateLegend();

        delete(<%= "graph_" + big.first.to_s %>)
        delete(<%= "graph_def_" + big.first.to_s %>)
         delete(ctx)

</script>

